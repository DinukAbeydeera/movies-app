extends ../layout

block content
  .detail
    .detail-header
      h1 #{movie.name} (#{movie.year})
      if movie.rating != null
        .badge.large Rating: #{movie.rating}
    if movie.genres && movie.genres.length
      p
        b Genres:
        |  #{' ' + movie.genres.join(', ')}
    p= movie.description
    p.text-muted Posted by #{movie.createdBy ? movie.createdBy.username : 'unknown'}

    .actions
      if isOwner
        a.btn.btn-primary(href=`/movies/${movie._id}/edit`) Edit
        button#deleteBtn.btn.btn-danger(type="button" data-id=movie._id) Delete
      a.btn.btn-outline(href="/movies") â† Back to list

  script.
    (function(){
      var btn = document.getElementById('deleteBtn');
      if(!btn) return;
      btn.addEventListener('click', function(){
        if(!confirm('Delete this movie?')) return;
        var id = btn.getAttribute('data-id');
        fetch('/movies/' + id, { method: 'DELETE', headers: { 'Accept': 'application/json' }})
          .then(r => r.ok ? r.json() : Promise.reject())
          .then(() => { window.location.href = '/movies'; })
          .catch(() => { alert('Delete failed'); });
      });
    })();
