doctype html
html
  head
    meta(charset="utf-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title= title || 'Movies App'
    link(rel="stylesheet", href="/css/styles.css")
    script.
      // Persist theme (light/dark) with localStorage
      (function(){
        try{
          var saved = localStorage.getItem('theme');
          if(saved){ document.documentElement.setAttribute('data-theme', saved); }
        }catch(e){}
      })();
  body
    header.navbar
      .brand
        a(href="/") ðŸŽ¬ Movies App
        small Manage & review your favorites
      .right
        span.theme-switch
          button(type="button" id="themeToggle" aria-label="Toggle theme") ðŸŒ—
        button#menu-toggle.nav-toggle(type="button" aria-label="Toggle navigation") â˜°
      ul#dropdown-menu.nav-links
        li: a(href="/") Home
        li: a(href="/movies") Movies
        if !currentUser
          li: a(href="/login") Login
          li: a(href="/register") Register
        else
          li: a(href="/movies/new") Add Movie
          li: a(href="/logout") Logout

    .container
      if success && success.length
        .flash-success= Array.isArray(success) ? success.join(', ') : success
      if error && error.length
        .flash-error= Array.isArray(error) ? error.join(', ') : error
      if success_msg && success_msg.length
        .flash-success= success_msg
      if error_msg && error_msg.length
        .flash-error= error_msg

      block content

    footer.site-footer
      p Â© #{new Date().getFullYear()} Movies App Â· Express Â· Pug Â· MongoDB

    // Interactions
    script.
      document.addEventListener('DOMContentLoaded', function () {
        var btn = document.getElementById('menu-toggle');
        var menu = document.getElementById('dropdown-menu');
        if(btn && menu){
          btn.addEventListener('click', function(e){ e.stopPropagation(); menu.classList.toggle('show'); });
          document.addEventListener('click', function(e){ if(!menu.contains(e.target) && !btn.contains(e.target)) menu.classList.remove('show'); });
          menu.querySelectorAll('a').forEach(a => a.addEventListener('click', ()=> menu.classList.remove('show')));
        }
        var t = document.getElementById('themeToggle');
        if(t){
          t.addEventListener('click', function(){
            var cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', cur);
            try{ localStorage.setItem('theme', cur); }catch(e){}
          });
        }
      });
